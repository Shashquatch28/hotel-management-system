{% extends 'base.html' %}

{% block title %}My Bookings{% endblock %}

{% block content %}

<div class="content-wrapper-narrow">

    <h2 style="text-align: center;">My Bookings</h2>
    
    {% if bookings %}
        <ul class="card-list">
            {% for booking in bookings %}
                <li class="card" style="background-color: rgba(210, 180, 140, 0.9);"> 
                    
                    <div class="card-content">
                        <h3 style="margin-bottom: 5px;">
                            Booking ID: {{ booking.booking_id }}
                        </h3>
                        
                        <p>Status: <span class="status-confirmed">{{ booking.status }}</span></p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; font-size: 0.9em; margin-bottom: 15px; color: var(--bg-color);">
                            <div>
                                <strong>Hotel ID:</strong> {{ booking.hotel_id }}<br>
                                <strong>Room:</strong> {{ booking.room_number }}
                            </div>
                            <div>
                                <strong>Check-in:</strong> {{ booking.checkin }}<br>
                                <strong>Check-out:</strong> {{ booking.checkout }}
                            </div>
                        </div>
                        
                        <!-- 
                          THIS IS THE FIXED PAYMENT SECTION 
                        -->
                        <div class="payment-status-wrapper">
                            <p class="payment-status">
                                Payment:
                                <!-- 
                                  FIX 1: Check booking.payment_set.all 
                                -->
                                {% if booking.payment_set.all %}
                                    <!-- 
                                      FIX 2: Use .first to get the object
                                    -->
                                    <span class="status-{{ booking.payment_set.first.status|lower }}">
                                        ${{ booking.payment_set.first.amount|floatformat:2 }} ({{ booking.payment_set.first.status }})
                                    </span>
                                {% else %}
                                    <span class="status-pending">
                                        Payment Not Found
                                    </span>
                                {% endif %}
                            </p>
                        </div>
                        <!-- 
                          END OF FIXED SECTION 
                        -->
                        
                        <div style="text-align: right; margin-top: 15px;">
                            <a href="{% url 'edit-booking' booking.booking_id %}" class="btn-edit">
                                Edit
                            </a> 
                            <a href="{% url 'cancel-booking' booking.booking_id %}" class="btn-cancel">
                                Cancel
                            </a>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p style="text-align: center;">You have not made any bookings yet.</p>
    {% endif %}

</div>


{% endblock %}